<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>6x6x6 LED Cube</title>
        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body>
        <header>
            <h1>6x6x6 LED Cube Project</h1>
            <nav>
                <ul>
                    <li><a href="#overview">Overview</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#gallery">Gallery</a></li>
                    <li><a href="#about">About</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <section id="overview">
                <h2>Overview</h2>
                <p>Welcome to the 6x6x6 LED Cube project page! Explore the design, features, and visual showcase of this exciting project.</p>
            </section>

            <section id="features">
                <h2>Features</h2>
                <ul>
                    <li>36 LEDs per layer</li>
                    <li>Custom animations</li>
                    <li>Modular design</li>
                </ul>
            </section>

            <section id="gallery">
                <h2>Gallery</h2>
                <p>Take a look at some images of the LED cube in action:</p>
                <div class="gallery-grid">
                    <div class="gallery-item">Image 1</div>
                    <div class="gallery-item">Image 2</div>
                    <div class="gallery-item">Image 3</div>
                </div>
            </section>

            <section id="about">
                <h2>About</h2>
                <p>This project is a demonstration of creativity and engineering. Built to showcase dynamic LED visuals, it’s perfect for learning and experimentation.</p>
            </section>
        </main>

            <section id="wifi">
                <h2>Wi-Fi Credentials</h2>
                <ul id="credList"></ul>
                <form id="credForm">
                    <input type="text" name="ssid" placeholder="SSID" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Add</button>
                </form>
            </section>

        <h1>Onboard LED</h1>

    <div class="row">
      <label for="color">Color:</label>
      <input id="color" type="color" value="#ff0000" />
      <button id="onBtn">On</button>
      <button id="offBtn">Off</button>
    </div>

    <p id="status">—</p>
        </main>

        <footer>
            <p>&copy; 2025 6x6x6 LED Cube Project. All rights reserved.</p>
        </footer>

        <script>
            async function loadCreds() {
                const res = await fetch('/credentials');
                const creds = await res.json();
                const list = document.getElementById('credList');
                list.innerHTML = '';
                creds.forEach(c => {
                    const li = document.createElement('li');
                    li.textContent = c.ssid + ' ';
                    const btn = document.createElement('button');
                    btn.textContent = 'Delete';
                    btn.onclick = async () => {
                        await fetch('/credentials/delete?ssid=' + encodeURIComponent(c.ssid));
                        loadCreds();
                    };
                    li.appendChild(btn);
                    list.appendChild(li);
                });
            }

            document.getElementById('credForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const params = new URLSearchParams();
                for (const [k, v] of formData.entries()) {
                    params.append(k, v);
                }
                await fetch('/credentials', {
                    method: 'POST',
                    body: params
                });
                e.target.reset();
                loadCreds();
            });

            loadCreds();
        </script>

           <script>
      // Small helper: send GET and show status
      let inflight; // AbortController for last request
      function send(path) {
        if (inflight) inflight.abort();
        inflight = new AbortController();
        const signal = inflight.signal;

        const url = path.startsWith('/') ? path : '/' + path;

        document.getElementById('status').textContent = `Request: ${url}`;
        return fetch(url, { method: 'GET', signal })
          .then(r => r.text().then(t => ({ ok: r.ok, text: t })))
          .then(({ ok, text }) => {
            document.getElementById('status').textContent =
              ok ? `OK: ${text}` : `Error: ${text}`;
          })
          .catch(err => {
            if (err.name === 'AbortError') return; // ignore cancelled
            document.getElementById('status').textContent = `Fetch error: ${err}`;
          });
      }

      // Debounce rapid color changes from the picker
      let debounceTimer;
      function sendColorDebounced(hex) {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => send(`/led/color/${hex}`), 120);
      }

      // Convert "#RRGGBB" -> "RRGGBB"
      function stripHash(hex) {
        return (hex || '').replace(/^#/, '');
      }

      // Wire up UI
      const color = document.getElementById('color');
      const onBtn = document.getElementById('onBtn');
      const offBtn = document.getElementById('offBtn');

      // Fire while dragging (smoother), and also on final change
      color.addEventListener('input',  () => sendColorDebounced(stripHash(color.value)));
      color.addEventListener('change', () => send(`/led/color/${stripHash(color.value)}`));

      onBtn.addEventListener('click',  () => send('/led/on'));
      offBtn.addEventListener('click', () => send('/led/off'));

      // Optional: initialize LED to current picker color on page load
      window.addEventListener('load', () => {
        send(`/led/color/${stripHash(color.value)}`);
      });
    </script>
    </body>
</html>
